<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/commons.css">
    <link rel="search" type="application/opensearchdescription+xml" title="Поиск паттернов" href="/search.xml">
    <title>Паттерн Money - Деньги. Описания паттернов проектирования. Паттерны проектирования. Design pattern ru</title>    <meta name="keywords" content="Описания паттернов проектирования, Паттерны проектирования, Design pattern ru, Паттерн Money" >    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
</head>
<body>
<div id="wrapper">
    <div id="header">
        <p><a href="/">Справочник &laquo;Паттерны проектирования&raquo;</a></p>
    </div>
    <div id="content">
        <h1>Money <em>(Деньги)</em></h1>
        <p><img src="/i/money.gif" alt="Паттерн проектирования Money"></p>
        <p><span class="quot">Паттерн проектирования Money</span></p>
        <h2>Описание Money</h2>
        <p>Огромное количество компьютеров в мире обрабатывают данные о деньгах. Удивительно, что класс Деньги до сих пор не является базовым в любом языке программирования. Недостаток такого рода типа данных приводит к проблемам, наиболее заметные из которых - работа с валютой. Если все вычисления в программе проделываются в одной валюте, никаких особых проблем нет, но как только вводится многовалютность - надо думать о том, чтобы не сложить 10 долларов с 10 йенами без перевода курсов валют. Менее заметна проблема с округлением. Денежные вычисления часто округляют до наименьшей из существующих мер. При этом легко не учесть копейки из-за ошибок округления.</p>
        <p>Что действительно хорошо в ООП, так это то, что вы можете исправить эти проблемы, созданием класса <acronym title="Паттерн Money (Деньги)">Money</acronym> (Деньги), чтобы работать с денежными величинами и избегать общих ошибок.</p>

<h2>Примеры реализации</h2>
<div class="code-snippet">
    <div class="code-snippet-header">
        <button class="code-snippet-tab" data-language="javascript">JavaScript</button>
        <button class="code-snippet-tab" data-language="cpp">C++</button>
        <button class="code-snippet-tab" data-language="go">Go</button>
        <button class="code-snippet-tab" data-language="python">Python</button>
        <button class="code-snippet-tab" data-language="php">PHP</button>
    </div>
    <div class="code-snippet-content">
        <button class="code-snippet-copy">Copy</button>
        
        <div class="code-snippet-panel" data-language="javascript">
            <pre><code>// Money Pattern in JavaScript
class Money {
    constructor(amount, currency) {
        // Store amount in cents to avoid floating point errors
        this.cents = Math.round(amount * 100);
        this.currency = currency;
    }
    
    get amount() {
        return this.cents / 100;
    }
    
    equals(other) {
        return other instanceof Money && 
               this.cents === other.cents && 
               this.currency === other.currency;
    }
    
    add(other) {
        if (this.currency !== other.currency) {
            throw new Error(`Cannot add ${this.currency} and ${other.currency}`);
        }
        return new Money((this.cents + other.cents) / 100, this.currency);
    }
    
    subtract(other) {
        if (this.currency !== other.currency) {
            throw new Error(`Cannot subtract ${this.currency} and ${other.currency}`);
        }
        return new Money((this.cents - other.cents) / 100, this.currency);
    }
    
    multiply(factor) {
        return new Money((this.cents * factor) / 100, this.currency);
    }
    
    divide(divisor) {
        if (divisor === 0) {
            throw new Error('Cannot divide by zero');
        }
        return new Money((this.cents / divisor) / 100, this.currency);
    }
    
    isZero() {
        return this.cents === 0;
    }
    
    isNegative() {
        return this.cents < 0;
    }
    
    toString() {
        return `${this.amount.toFixed(2)} ${this.currency}`;
    }
    
    static zero(currency) {
        return new Money(0, currency);
    }
}

// Usage
const price1 = new Money(19.99, 'USD');
const price2 = new Money(5.01, 'USD');
const total = price1.add(price2);
console.log(total.toString()); // 25.00 USD

const discount = total.multiply(0.1);
const finalPrice = total.subtract(discount);
console.log(finalPrice.toString()); // 22.50 USD</code></pre>
        </div>
        
        <div class="code-snippet-panel" data-language="cpp">
            <pre><code>// Money Pattern in C++
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;stdexcept&gt;

class Money {
private:
    long cents;
    std::string currency;
    
public:
    Money(double amount, const std::string& currency) 
        : cents(static_cast&lt;long&gt;(amount * 100)), currency(currency) {}
    
    double getAmount() const {
        return static_cast&lt;double&gt;(cents) / 100.0;
    }
    
    std::string getCurrency() const {
        return currency;
    }
    
    bool equals(const Money& other) const {
        return cents == other.cents && currency == other.currency;
    }
    
    Money add(const Money& other) const {
        if (currency != other.currency) {
            throw std::runtime_error("Cannot add different currencies");
        }
        return Money((cents + other.cents) / 100.0, currency);
    }
    
    Money subtract(const Money& other) const {
        if (currency != other.currency) {
            throw std::runtime_error("Cannot subtract different currencies");
        }
        return Money((cents - other.cents) / 100.0, currency);
    }
    
    Money multiply(double factor) const {
        return Money((cents * factor) / 100.0, currency);
    }
    
    Money divide(double divisor) const {
        if (divisor == 0) {
            throw std::runtime_error("Cannot divide by zero");
        }
        return Money((cents / divisor) / 100.0, currency);
    }
    
    bool isZero() const {
        return cents == 0;
    }
    
    bool isNegative() const {
        return cents &lt; 0;
    }
    
    std::string toString() const {
        return std::to_string(getAmount()) + " " + currency;
    }
    
    static Money zero(const std::string& currency) {
        return Money(0.0, currency);
    }
};

// Usage
int main() {
    Money price1(19.99, "USD");
    Money price2(5.01, "USD");
    Money total = price1.add(price2);
    std::cout &lt;&lt; total.toString() &lt;&lt; std::endl; // 25.00 USD
    
    Money discount = total.multiply(0.1);
    Money finalPrice = total.subtract(discount);
    std::cout &lt;&lt; finalPrice.toString() &lt;&lt; std::endl; // 22.50 USD
    
    return 0;
}</code></pre>
        </div>
        
        <div class="code-snippet-panel" data-language="go">
            <pre><code>// Money Pattern in Go
package main

import (
    "fmt"
    "math"
)

type Money struct {
    cents    int64
    currency string
}

func NewMoney(amount float64, currency string) Money {
    return Money{
        cents:    int64(math.Round(amount * 100)),
        currency: currency,
    }
}

func (m Money) Amount() float64 {
    return float64(m.cents) / 100.0
}

func (m Money) Currency() string {
    return m.currency
}

func (m Money) Equals(other Money) bool {
    return m.cents == other.cents && m.currency == other.currency
}

func (m Money) Add(other Money) (Money, error) {
    if m.currency != other.currency {
        return Money{}, fmt.Errorf("cannot add different currencies")
    }
    return Money{
        cents:    m.cents + other.cents,
        currency: m.currency,
    }, nil
}

func (m Money) Subtract(other Money) (Money, error) {
    if m.currency != other.currency {
        return Money{}, fmt.Errorf("cannot subtract different currencies")
    }
    return Money{
        cents:    m.cents - other.cents,
        currency: m.currency,
    }, nil
}

func (m Money) Multiply(factor float64) Money {
    return Money{
        cents:    int64(math.Round(float64(m.cents) * factor)),
        currency: m.currency,
    }
}

func (m Money) Divide(divisor float64) (Money, error) {
    if divisor == 0 {
        return Money{}, fmt.Errorf("cannot divide by zero")
    }
    return Money{
        cents:    int64(math.Round(float64(m.cents) / divisor)),
        currency: m.currency,
    }, nil
}

func (m Money) IsZero() bool {
    return m.cents == 0
}

func (m Money) IsNegative() bool {
    return m.cents &lt; 0
}

func (m Money) String() string {
    return fmt.Sprintf("%.2f %s", m.Amount(), m.currency)
}

func ZeroMoney(currency string) Money {
    return Money{cents: 0, currency: currency}
}

// Usage
func main() {
    price1 := NewMoney(19.99, "USD")
    price2 := NewMoney(5.01, "USD")
    total, _ := price1.Add(price2)
    fmt.Println(total.String()) // 25.00 USD
    
    discount := total.Multiply(0.1)
    finalPrice, _ := total.Subtract(discount)
    fmt.Println(finalPrice.String()) // 22.50 USD
}</code></pre>
        </div>
        
        <div class="code-snippet-panel" data-language="python">
            <pre><code># Money Pattern in Python
from decimal import Decimal, ROUND_HALF_UP
from typing import Union

class Money:
    def __init__(self, amount: Union[float, Decimal], currency: str):
        # Use Decimal for precise decimal arithmetic
        self.amount = Decimal(str(amount)).quantize(Decimal('0.01'), rounding=ROUND_HALF_UP)
        self.currency = currency
    
    def __add__(self, other: 'Money') -> 'Money':
        if self.currency != other.currency:
            raise ValueError(f"Cannot add {self.currency} and {other.currency}")
        return Money(self.amount + other.amount, self.currency)
    
    def __sub__(self, other: 'Money') -> 'Money':
        if self.currency != other.currency:
            raise ValueError(f"Cannot subtract {self.currency} and {other.currency}")
        return Money(self.amount - other.amount, self.currency)
    
    def __mul__(self, factor: Union[float, Decimal]) -> 'Money':
        return Money(self.amount * Decimal(str(factor)), self.currency)
    
    def __truediv__(self, divisor: Union[float, Decimal]) -> 'Money':
        if divisor == 0:
            raise ValueError("Cannot divide by zero")
        return Money(self.amount / Decimal(str(divisor)), self.currency)
    
    def __eq__(self, other: 'Money') -> bool:
        return self.amount == other.amount and self.currency == other.currency
    
    def __str__(self) -> str:
        return f"{self.amount} {self.currency}"
    
    def is_zero(self) -> bool:
        return self.amount == 0
    
    def is_negative(self) -> bool:
        return self.amount &lt; 0
    
    @classmethod
    def zero(cls, currency: str) -> 'Money':
        return cls(0, currency)

# Usage
if __name__ == "__main__":
    price1 = Money(19.99, "USD")
    price2 = Money(5.01, "USD")
    total = price1 + price2
    print(total)  # 25.00 USD
    
    discount = total * 0.1
    final_price = total - discount
    print(final_price)  # 22.50 USD</code></pre>
        </div>
        
        <div class="code-snippet-panel" data-language="php">
            <pre><code>&lt;?php
// Money Pattern in PHP
class Money {
    private $amount;
    private $currency;
    
    public function __construct($amount, $currency) {
        // Use BC Math for precise decimal arithmetic
        $this->amount = bcadd($amount, '0', 2);
        $this->currency = $currency;
    }
    
    public function getAmount() {
        return $this->amount;
    }
    
    public function getCurrency() {
        return $this->currency;
    }
    
    public function equals(Money $other) {
        return bccomp($this->amount, $other->amount, 2) === 0 && 
               $this->currency === $other->currency;
    }
    
    public function add(Money $other) {
        if ($this->currency !== $other->currency) {
            throw new InvalidArgumentException("Cannot add different currencies");
        }
        return new Money(bcadd($this->amount, $other->amount, 2), $this->currency);
    }
    
    public function subtract(Money $other) {
        if ($this->currency !== $other->currency) {
            throw new InvalidArgumentException("Cannot subtract different currencies");
        }
        return new Money(bcsub($this->amount, $other->amount, 2), $this->currency);
    }
    
    public function multiply($factor) {
        return new Money(bcmul($this->amount, $factor, 2), $this->currency);
    }
    
    public function divide($divisor) {
        if ($divisor == 0) {
            throw new InvalidArgumentException("Cannot divide by zero");
        }
        return new Money(bcdiv($this->amount, $divisor, 2), $this->currency);
    }
    
    public function isZero() {
        return bccomp($this->amount, '0', 2) === 0;
    }
    
    public function isNegative() {
        return bccomp($this->amount, '0', 2) &lt; 0;
    }
    
    public function __toString() {
        return $this->amount . " " . $this->currency;
    }
    
    public static function zero($currency) {
        return new Money('0', $currency);
    }
}

// Usage
$price1 = new Money('19.99', 'USD');
$price2 = new Money('5.01', 'USD');
$total = $price1->add($price2);
echo $total . "\n"; // 25.00 USD

$discount = $total->multiply('0.1');
$finalPrice = $total->subtract($discount);
echo $finalPrice . "\n"; // 22.50 USD
?&gt;</code></pre>
        </div>
    </div>
</div>

<p class="note">Использована иллюстрация с сайта <a href="/martin-fowler.html">Мартина Фаулера</a>.</p>			<p class="note"><noindex><a href="http://martinfowler.com/eaaCatalog/money.html">Источник</a></noindex></p>        </div>
    <div style="clear:both;margin-top: -2.5em">&nbsp;</div>
</div>
<ul id="footer-menu">
    <li><a href="/">Главная</a></li>
    <li><a href="/patterns/" title="Список шаблонов проектирования">Список паттернов</a></li>
    <li>Сайт создан и поддерживается <a href="https://vasiliy.pro">Василием Кулаковым</a>.</li>
</ul>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3BEMCB742Q"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-3BEMCB742Q');
</script>
<!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
    (function(w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter6876103 = new Ya.Metrika({id:6876103,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
            }
            catch(e) { }
        });
    })(window, 'yandex_metrika_callbacks');
</script></div>
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script>
<noscript><div><img src="//mc.yandex.ru/watch/6876103" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Code Snippet JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all code snippet components
    const codeSnippets = document.querySelectorAll('.code-snippet');
    
    codeSnippets.forEach(function(snippet) {
        const tabs = snippet.querySelectorAll('.code-snippet-tab');
        const panels = snippet.querySelectorAll('.code-snippet-panel');
        const copyButton = snippet.querySelector('.code-snippet-copy');
        
        // Set default active tab (JavaScript)
        const defaultTab = snippet.querySelector('[data-language="javascript"]');
        if (defaultTab) {
            defaultTab.classList.add('active');
            const defaultPanel = snippet.querySelector('.code-snippet-panel[data-language="javascript"]');
            if (defaultPanel) {
                defaultPanel.classList.add('active');
            }
        }
        
        // Tab switching functionality
        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                const language = this.getAttribute('data-language');
                
                // Remove active class from all tabs and panels
                tabs.forEach(t => t.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding panel
                this.classList.add('active');
                const targetPanel = snippet.querySelector(`.code-snippet-panel[data-language="${language}"]`);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            });
        });
        
        // Copy functionality
        if (copyButton) {
            copyButton.addEventListener('click', function() {
                const activePanel = snippet.querySelector('.code-snippet-panel.active');
                if (activePanel) {
                    const codeText = activePanel.textContent;
                    
                    // Copy to clipboard
                    navigator.clipboard.writeText(codeText).then(function() {
                        copyButton.textContent = 'Copied!';
                        copyButton.classList.add('copied');
                        
                        setTimeout(function() {
                            copyButton.textContent = 'Copy';
                            copyButton.classList.remove('copied');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('Failed to copy text: ', err);
                    });
                }
            });
        }
    });
});
</script>
</body>
</html>